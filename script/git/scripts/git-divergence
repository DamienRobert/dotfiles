#!/bin/bash

set -e

(
    function branch() {
        git current-branch
    }

    function ensure_valid_ref() {
        ref=$1
        git rev-parse --verify $ref >/dev/null || exit 1
    }

    if [[ $# == 2 ]]; then
        LOCAL=$1
        REMOTE=$2
    elif [[ $# == 1 ]]; then
        LOCAL=`git current-branch`
        REMOTE=$1
    else
        LOCAL=`git current-branch`
        REMOTE=origin/$LOCAL
    fi

    ensure_valid_ref $LOCAL
    ensure_valid_ref $REMOTE

    function gitlog() {
      git --no-pager log --graph --pretty=summary "$@"
      #git --no-pager log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit --date=relative "$@"
    }

    echo "Changes from local ${LOCAL} to remote ${REMOTE}:"
    echo

    echo "- Incoming:"
    gitlog $LOCAL..$REMOTE

    echo
    echo
    echo "- Outgoing:"
    gitlog $REMOTE..$LOCAL
) | less -r
