#!/bin/zsh

# List all the dependency of a package
# (use pactree instead)
typeset -A walked_nodes
result=( )

depends() {
  list=($(pacman -Qi "$1" |grep Depends | cut -d ':' -f 2))
  #list=($=list)
  for i in $list; do
    i=${i%%\>*}
    i=${i%%\=*}
    if [ $i != "None" ]; then
    # if we've walked this node before, skip. This drastically
    # reduces overhead for a relatively cheap operation
    [[ ${walked_nodes[$i]} -eq 1 ]] && return 0
    walked_nodes[$i]=1
      depends $i
    fi
  done
}

for i in $@; do
  depends $i ""
done
#print ${(k)walked_nodes} |sort
for pkg in ${(k)walked_nodes}; do
        echo "  $pkg"
    done | sort
    exit 0
