pacman
=====

Install/Remove
--------------

pacman -Syu
pacman -S --needed $CORE

#Lighter texlive-most: sudo pacman -Rcs texlive-fontsextra texlive-pstricks

Query
-----
pacman -Qdt #orphans packages
  (-d: dependency packages, -t: unrequired packages)
sudo pacman -Rcs $(pacman -Qdtq)
  (-Qq: output for script; see also -Rn to not create .pacsave, or -Rcu to remove groups)

-Qm #foreigns packages
-Qn #natives packages
-Qe #explicitely installed packages
-Qg group #list packages part of group
-Qu: out of date packages

-Qo file: print the package owning a file
-Ql package: list files in package
-Qc package: show changelog
[for a local package, use -Q?p package.tar.xz]

Remove
------

pacman -p -Rc ploum #packages dépendant du package ploum
 #see also pactree ploum
pacman -p -Rs ploum #packages dont uniquement ploum dépend et qui ne sont pas installés explicitement (un autre s relaxe cette condition)
  #see also pactree -r ploum
pacman -p -Ru ploum plim #enlève ploum s'il n'est pas requis par un autre package
ex: pacman -p -Ru group #pour enlever les packets dont on ne se sert pas d'un groupe
    (pacman -Rc risque de tout enlever)
-Rn: don't save config files in .pacsave

Database
--------

pacman -D --asdeps ploum
pacman -D --asexplicit ploum  #dire si c'est une dep ou une version explicitement installée

Options
-------

-d: skips dependency checks 
-dd: don't add dependancy packages when installing a package
--noprogressbar: do not show progress bar
--noscriptlet: do not use install scriptlet
-p: only print targets, don't do operation

pacaur
======

pacaur -k #check for updates
pacaur -u #update
pacaur -u --devel #upgadre aur packages, --devel is here to also upgrade the *git packages
pacaur -y pkg #install

Keys
====

pacman-key --init
pacman-key --populate archlinux
pacman-key --refresh-keys

If pacman needs some more keys, several ways around that:
- Try updating archlinux-keyring
- sudo pacman-key --refresh-keys
- sudo pacman-key --populate archlinux
- Sign locally:  sudo pacman-key --lsign-key 753E0F1F; sudo pacman-key -r 753E0F1F

Database
========

https://wiki.archlinux.org/index.php/Pacman_tips#Backing_up_and_retrieving_a_list_of_installed_packages
paclog-pkglist: list packages installed from reading pacman.log

Binaries
========

- makepkg, pacman, pacman-key
- cleanupdelta: cleanupdelta [-b <pacman db>] core extra ... : check the listed sync databases
- pacman-db-upgrade: upgrade the local pacman db to a newer format
- pacman-optimize: relocate files in pacman db to a continuous location to improve database performance
- pacsort: sort files according to their version numbers
- pactree: produces a dependency tree for a package
- pkgdelta: package delta generation utility (only generates the delta between two packages)
- repo-add, repo-remove@: used to help build a package database for packages built with makepkg
- repo-elephant@: shows an elephant (two ascii arts at random)
- testdb: test pacman database
- testpkg: test a pacman package
- vercmp: compares two version numbers

Tools
=====

# official
- reflector: retrieve the latest mirror list from the MirrorStatus page, filter the most up-to-date mirrors, sort them by speed

# aur
- cower: search the aur
- package-query (like cower, used by yaourt)
- pacaur: aur helper
- powerpill, pacserve: multiple downloads resp local cache to speed up dl

Custom scripts
==============

# pacman-contrib
- /usr/bin/bacman: rebuild a package from the files in the system 
- /usr/bin/pacsearch: sysntax coloring to pacman -Ss
- /usr/bin/paclist: list packages from a repo
- /usr/bin/pacsysclean: list packages by increasing size
- /usr/bin/pacdiff: look for *.pac* and merge
- /usr/bin/paclog-pkglist: list the packages installed from pacman.log
- /usr/bin/pacscripts: list the post/pre-install/remove scripts of a package
- /usr/bin/paccache: fine control on cache management

# ~/script/pacman/
- 00stat_pacnem,01diff_pacnew,02diff-gen-pacnew: pour voir s'il y a des nouveaux .pacnew
- archlinuxupdateconf: run meld for each pacnew found (usually I prefer to
  use pacdiff)
- aur: build an aur package
- pacclean: print all but the 3 newest cached package files
- pacgrep: pacgrep 'pattern' packages to took for a patter in the files of packages
- pacgroup: A simple script that informs the user of pacman groups that are
partially installed or upgraded.
- pacman_dependency: list all dependency of a package
- pacman_feed -opts args: run 'args' and pass the first word to 'pacman -opts'
    #not so usefull now that I know the -q option...
- pacman_groupinfo: launch pacman -Qi on packages from group $@
- pacman_optdep: list optional dependencies of installed packages
- pacsrc: get all sources url for an Arch package
- pacverify: verify all pacman packages against installed files (by checking if the sha256sum is the same)
- pacman_log_clean: output a cleanup up version of pacman log

# Xyne's scripts
http://xyne.archlinux.ca/projects/#arch-linux
http://xyne.archlinux.ca/projects/#aur
http://xyne.archlinux.ca/projects/#pacman
-> http://xyne.archlinux.ca/projects/pkg_scripts/: A collection of pacman and package-related utilities.
-> http://xyne.archlinux.ca/projects/pacnew_scripts/: A collection of scripts to help merge changes in .pacnew files.
-> http://xyne.archlinux.ca/projects/pacserve/: Easily share Pacman packages between computers. A replacement for PkgD.
-> http://xyne.archlinux.ca/projects/pm2ml/: Generate metalinks for downloading Pacman packages and databases.
-> http://xyne.archlinux.ca/projects/powerpill/: download packages in parallel
[x] http://xyne.archlinux.ca/scripts/pacman/: pacman related scripts
ex: http://xyne.archlinux.ca/scripts/pacman/repkg to easily repackage for metadata change
-> http://xyne.archlinux.ca/projects/pbget/: dl pkgbuilds
(Available in ~/var/dist/arch/xyne
To get the latest version: pacaur -m pkg_scripts pacnew_scripts)

Mirror List
===========

All:
https://www.archlinux.org/mirrorlist/all/

All With Score:
https://www.archlinux.org/mirrorlist/?country=all&protocol=http&ip_version=4&use_mirror_status=on

Country Specific:
https://www.archlinux.org/mirrorlist/?country=FR&protocol=http&ip_version=4&use_mirror_status=on

Ex:
COUNTRY='FR'
URL="https://www.archlinux.org/mirrorlist/?country=${COUNTRY}&protocol=http&ip_version=4&use_mirror_status=on"
if /usr/bin/curl --silent --fail --output mirrorlist "${URL}"; then
  /usr/bin/sed -i 's/#Server/Server/g' mirrorlist
fi
