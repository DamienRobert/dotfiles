# vim: fdm=marker

# Variables {{{
# ========

set editor=`echo \$EDITOR`

#charset of messages without content type
#set assumed_charset="utf-8:utf-16:iso8859-1"
set assumed_charset="utf-8:iso8859-1"
set config_charset="utf-8"
set attach_charset="utf-8:iso-8859-1" #attached files encoding

set mbox=+received #not used
set mbox_type=Maildir
set header_cache="~/Mail/.header_cache"
set certificate_file=~/.mutt/certificates
set tmpdir=~/tmp

set copy=yes #keep sent mails
set noconfirmappend #save message without confirmation
set move=no #when moving message, erase original without confirmation
#set delete=yes #delete without confirmation

set use_from #use custom from
set edit_hdrs
set mark_old
set postpone=ask-yes
set recall=no #no recall of existing postponed message
set reverse_alias #use .muttalias for reverse alias lookup
set reverse_name=yes #if To match alternates, use this one as From
unset abort_nosubject
set abort_unmodified=ask-yes

set fast_reply
set reply_to=ask-yes #should be default value
set include=yes

#sort
set strict_threads
set sort=threads
set sort_aux="last-date" 

set tilde #end of message markers
set nomarkers #don't mark long lines

set nobeep
set beep_new

set pager_index_lines=5
#set pager_stop

set print_command="a2ps -q --center-title=mail -Email -o /tmp/robert_mutt_print.ps | evince /tmp/robert_mutt_print.ps"
# }}}

# Format {{{
# ======

set attribution="From %n, %d :"
#pour le format des dates dans l'index, et l'attribution (%d)

set date_format= "%a %d %b %Y at %T (%Z)"
#Default: "!%a, %b %d, %Y at %I:%M:%S%p %Z"

set forward_format="[%a: %s] (fwd)"
#Default: "[%a: %s]"

set status_format="%?b?%b&-?%r- %v: %f \
[Msgs:%?M?%M/?%m\
%?n? New:%n?%?o? Old:%o?%?d? Del:%d?%?F? Flag:%F?%?t? Tag:%t?\
%?p? Post:%p? \
%?L?%L/?%l]\
-%>--(%?V?%V&%s?)--(%P)---"
#Default: "-%r-Mutt: %f [Msgs:%?M?%M/?%m%?n? New:%n?%?o? Old:%o?%?d?\
#  Del:%d?%?F? Flag:%F?%?t? Tag:%t?%?p? Post:%p?%?b? Inc:%b?%?l?\
#  %l?]---(%s/%S)-%>-(%P)---"
#I don't use %s/%S since I don't change sort aux

set compose_format="-- %v (%h): Compose [Approx. msg size: %l   Atts: %a]%>-"
#Default: "-- Mutt: Compose  [Approx. msg size: %l   Atts: %a]%>-"

set index_format="%4C %Z %[%F] %-15.15L %?M?(#%03M)&(%4c)?%?H? [%H]? %s"
#Default: "%4C %Z %{%b %d} %-15.15L (%4l) %s"
#I am just adding the number of hidden messages

set pager_format="-%Z-%e/%E (%{%T}[%[%H]h]/%(%T)): %-20.20n %s"
#Default: "-%Z- %C/%m: %-20.20n   %s"

set message_format="%-.16n: %s"
#defaut: %s

#Defaut: set folder_format="%2C %t %N %F %2l %-8.8u %-8.8g %8s %d %f"
#Defaut: set alias_format="%4n %2f %t %-10a   %r"
#Default: set attach_format="%u%D%I %t%4n %T%.40d%> [%.7m/%.10M, %.6e%?C?, %C?, %s] "
#Default: set pgp_entry_format="%4n %t%f %4l/0x%k %-4a %2c %u"
#}}}

# Headers {{{
# =======

unignore *
ignore X-Virus-Scanned X-Greylist X-Spam X-Mail-Format-Warning
ignore X-Collectif X-Loop 
# Spams infos
ignore X-IronPort X-Ovh X-NDUS X-VR X-NFIT X-Scanned-By
ignore Received Message-ID References
ignore Status Mime-Version 
ignore List-
unignore List-Id
#ignore Precedence: Errors-To: 
ignore DKIM-Signature
ignore DomainKey-Signature Authentication-Results
ignore X-Received X-Original-MessageID X-Sequence X-no-archive X-IPAS-Result
ignore X-MS-Exchange-CrossPremises x-forefront X-Assp X-DSPAM

hdr_order "From " Date From: To Cc Subject List-Id Reply-To Return-Path Sender Delivered-To  Organization Newsgroup Content Errors-To User-Agent In-Reply lines Precedence Approved Resent- X- 
#}}}

# Bindings {{{
# =======

# groups: generic,alias,attach,browser,editor,index,compose,pager,pgp,postpone
# warning: generic does not contain pager or editor

#some /etc/muttrc change this
bind compose <Return> view-attach

#pager
bind pager      <Up>    previous-line
bind pager      <Down>  next-line
bind pager      K       previous-line
bind pager      J       next-line

bind index      +       collapse-thread
bind index      -       collapse-thread
bind index      *       collapse-all
bind index      <esc>T   tag-subthread
bind index      <esc>D   delete-subthread
bind index      <esc>R   read-subthread
bind index      <esc>U   undelete-subthread
bind index      <esc>t   tag-thread
bind index      <esc>d   delete-thread
bind index      <esc>r   read-thread
bind index      <esc>u   undelete-thread
bind index      <F6>  fetch-mail
bind index      <F5>  imap-fetch-mail
bind index <esc><F4> forget-passphrase
bind index      G  last-entry
bind index      <esc>G  first-entry
#bind index      p  parent-message
#bind index      P  print-message
bind index      <esc>S  decrypt-save
bind index      z extract-keys
bind index      <esc>z mail-key
bind index      <esc>c next-unread-mailbox
bind index      <esc>C change-folder-readonly
bind index      <esc>V decrypt-copy
bind index      <esc>v decode-copy
bind index      \Ct query

bind generic      j   next-entry
bind generic      k   previous-entry
#does not seem to work with generic only
bind index      j   next-entry
bind index      k   previous-entry
bind index      <esc>j   next-thread
bind index      <esc>k   previous-thread
bind index      <esc>J   next-subthread
bind index      <esc>K   previous-subthread
bind index      J   next-undeleted
bind index      K   previous-undeleted
bind index      <down>   next-entry
bind index      <up>   previous-entry
bind index      <esc><down>   next-thread
bind index      <esc><up>   previous-thread
bind index      <right> next-new-then-unread
bind index      <left>  previous-new-then-unread
bind index      <esc><right> next-unread
bind index      <esc><left>  previous-unread
#bind index      <esc><left>   parent-message

bind index      \Cb  previous-page 
bind index      \Cf  next-page 
bind pager      \Cb  previous-page 
bind pager      \Cf  next-page 
bind generic \Cv what-key
bind generic <esc>< top-page
bind generic <esc>> bottom-page
bind generic <esc>= middle-page
bind generic < current-top
bind generic > current-bottom
bind generic = current-middle
bind generic      \Cn   next-line
bind generic      \Cp   previous-line
bind generic <esc>n search-opposite
#}}}

# macros {{{
# ======

#ugly hack: don't go to next message with pagedown
macro pager <pagedown> ":set pager_stop\n<next-page>:unset pager_stop\n" "next-page"

# simulate the old url menu
macro index \cu |urlview\n 'call urlview to extract URLs out of a message'
macro pager \cu |urlview\n 'call urlview to extract URLs out of a message'

#}}}

# Mime {{{
# ====

auto_view text/html 
alternative_order text/enriched text/plain text/html text

# for this mime type, look up the real mime in mime.types
mime_lookup application/octet-stream
#}}}

# Colors {{{
# ======

# basic monocolor screen
mono  bold          bold
mono  underline     underline
mono  indicator     reverse
mono  error         bold
mono  tilde	 bold
mono  hdrdefault bold
mono  body          bold                            "^gpg: Good signature"
mono  body          bold                            "^gpg: BAD signature from.*"

color normal	 default	default
color error	 brightred	default
color hdrdefault cyan	         default
color signature	 red		default
color indicator	 white		cyan
color status	 yellow	        blue
color tree	 yellow		default
color message	 default	default
color attachment brightmagenta	default
color search	 white		red
color markers    green          default           
color tilde	 green		default

#on colorie différemment les headers les plus importants

color header brightgreen  default "^From"
color header brightgreen  default "^From:"
color header brightgreen default "^Date:"
color header brightgreen default "^To:"
color header brightgreen default "^Cc:"
color header brightgreen default "^Subject:"
color header yellow default "^List-id:"
color header yellow default "^Reply-To:"
color header yellow default "^In-Reply-To:"
color header yellow default "^Delivered-To:"
color header yellow default "^Return-Path:"
color header yellow default "^Organization:"
color header yellow default "^Newsgroup:"
color header yellow default "^Sender:"

color header yellow default "^Content-.*:"

#quotes
color quoted	    red		default
color quoted1       yellow       default         
color quoted2       blue            default         
color quoted3       green          default         
color quoted4       cyan             default         

color index         brightgreen            default         "~p!~F"                     # messages to me
color index         green   default         "~Q"                        # messages that have been replied to
color index         yellow      default         "~P"                        # messages from me
color index          black    yellow         "~v~(!~N)"                  # collapsed thread with no unread
color index         brightblack          yellow         "~v~(~N|~O)"             # collapsed thread with some unread
color index         brightblack       default             "~="                    # duplicated messages
color index         default             cyan         "~T"                       # tagged messages
color index         magenta            default         "~N"                     # new messages
color index         magenta            default         "~O"                     # old messages
color index         red             default         "~F"                        # flagged messages
color index         brightred       default         "~E"                        # expired messages
color index         white           red             "~D"                        # deleted messages

color body          default     brightwhite         " "    # nbsp
# emoticons 
color body          brightblack     default         "[;:][-o][)/(|]"    # emoticons
color body          brightblack     default         "[;:][)(|]"         # emoticons
color body          brightblack     default         "[*]?((N)?ACK|CU|LOL|SCNR|BRB|BTW|CWYL|\
                                                     |FWIW|vbg|GD&R|HTH|HTHBE|IMHO|IMNSHO|\
                                                     |IRL|RTFM|ROTFL|ROFL|YMMV)[*]?"
color body          brightblack     default         "[ ][*]+[^*]*[*]+[ ]?" # bold
color body          brightblack     default         "[ ]?[*]+[^*]*[*]+[ ]" # bold 
color body          brightblack     default         "[ ][_]+[^_]*[_]+[ ]?" # italic
color body          brightblack     default         "[ ]?[_]+[^_]*[_]+[ ]" # italic

## pgp
color body          yellow      default         "^gpg: .*"
color body          red             default         "(BAD signature)"
color body          green            default         "(Good signature)"
color body        brightyellow    default     "(WARNING)"
color body          green     default         "^gpg: Good signature .*"
color body          brightyellow      default         "^gpg: WARNING.*"
color body          red      default             "^gpg: BAD signature from.*"

# yes, an insance URL regex
color body          magenta             white         "([a-z][a-z0-9+-]*://(((([a-z0-9_.!~*'();:&=+$,-]|%[0-9a-f][0-9a-f])*@)?((([a-z0-9]([a-z0-9-]*[a-z0-9])?)\\.)*([a-z]([a-z0-9-]*[a-z0-9])?)\\.?|[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+)(:[0-9]+)?)|([a-z0-9_.!~*'()$,;:@&=+-]|%[0-9a-f][0-9a-f])+)(/([a-z0-9_.!~*'():@&=+$,-]|%[0-9a-f][0-9a-f])*(;([a-z0-9_.!~*'():@&=+$,-]|%[0-9a-f][0-9a-f])*)*(/([a-z0-9_.!~*'():@&=+$,-]|%[0-9a-f][0-9a-f])*(;([a-z0-9_.!~*'():@&=+$,-]|%[0-9a-f][0-9a-f])*)*)*)?(\\?([a-z0-9_.!~*'();/?:@&=+$,-]|%[0-9a-f][0-9a-f])*)?(#([a-z0-9_.!~*'();/?:@&=+$,-]|%[0-9a-f][0-9a-f])*)?|(www|ftp)\\.(([a-z0-9]([a-z0-9-]*[a-z0-9])?)\\.)*([a-z]([a-z0-9-]*[a-z0-9])?)\\.?(:[0-9]+)?(/([-a-z0-9_.!~*'():@&=+$,]|%[0-9a-f][0-9a-f])*(;([-a-z0-9_.!~*'():@&=+$,]|%[0-9a-f][0-9a-f])*)*(/([-a-z0-9_.!~*'():@&=+$,]|%[0-9a-f][0-9a-f])*(;([-a-z0-9_.!~*'():@&=+$,]|%[0-9a-f][0-9a-f])*)*)*)?(\\?([-a-z0-9_.!~*'();/?:@&=+$,]|%[0-9a-f][0-9a-f])*)?(#([-a-z0-9_.!~*'();/?:@&=+$,]|%[0-9a-f][0-9a-f])*)?)[^].,:;!)? \t\r\n<>\"]"
# and a heavy handed email regex
color body          red        white         "((@(([0-9a-z-]+\\.)*[0-9a-z-]+\\.?|#[0-9]+|\\[[0-9]?[0-9]?[0-9]\\.[0-9]?[0-9]?[0-9]\\.[0-9]?[0-9]?[0-9]\\.[0-9]?[0-9]?[0-9]\\]),)*@(([0-9a-z-]+\\.)*[0-9a-z-]+\\.?|#[0-9]+|\\[[0-9]?[0-9]?[0-9]\\.[0-9]?[0-9]?[0-9]\\.[0-9]?[0-9]?[0-9]\\.[0-9]?[0-9]?[0-9]\\]):)?[0-9a-z_.+%$-]+@(([0-9a-z-]+\\.)*[0-9a-z-]+\\.?|#[0-9]+|\\[[0-2]?[0-9]?[0-9]\\.[0-2]?[0-9]?[0-9]\\.[0-2]?[0-9]?[0-9]\\.[0-2]?[0-9]?[0-9]\\])"
# }}}

# Files {{{
# =====

set alias_file=~/.mutt/muttalias
source ~/.mutt/muttalias

set query_command = "abook --mutt-query '%s'"
macro generic,index,pager \ca "<shell-escape>abook<return>" "launch abook"
macro index,pager A "<pipe-message>abook --add-email<return>" "add the sender address to abook"
macro index,pager A "<pipe-message>abook --add-email<return>" "add the sender address to abook"
#abook --convert --informat mutt --infile ~/.mutt/muttalias --outformat abook --outfile ~/.abook/addressbook-new

#personnal config
source ~/.mutt/muttrc.perso
#}}}
